<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />
  <title>名片二维码生成器</title>

  <style>
    :root{
      --pad: 14px;
      --bg: #0b0b0b;
      --panel: #111;
      --card: #151515;
      --border: #2a2a2a;
      --text: #fff;
      --muted: rgba(255,255,255,.7);
      --radius: 14px;
      --h: 44px;
    }
  
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);
      color:var(--text);
    }
  
    .wrap{
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
  
    header{
      padding: var(--pad);
      background: var(--panel);
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
  
    /* 表单：手机单列，宽屏双列 */
    .form-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
  
    header label{
      font-size: 12px;
      color: var(--muted);
      display:flex;
      flex-direction:column;
      gap:8px;
    }
  
    header input, header button{
      height: var(--h);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: 0 12px;
      outline: none;
    }
  
    header input::placeholder{ color: rgba(255,255,255,.35); }
  
    .row{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 12px;
    }
  
    /* 文件选择控件在 iOS 看起来很丑，给它包一层更像按钮 */
    .file{
      flex: 1 1 240px;
      min-width: 220px;
    }
    .file input[type="file"]{
      height: auto;
      padding: 10px 12px;
    }
  
    header button{
      cursor:pointer;
      padding: 0 14px;
      font-weight: 600;
    }
    header button.primary{
      background:#2b6cff;
      border-color:#2b6cff;
    }
  
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      width: 100%;
    }
    .actions button{
      flex: 1 1 120px;
    }
  
    main{
      position:relative;
      flex:1;
      display:flex;
      flex-direction:column;
      min-height: 0; /* 关键：让 canvas 可撑满剩余空间 */
    }
  
    /* 画布：占满剩余空间 */
    canvas{
      width: 100%;
      flex: 1;
      display:block;
      touch-action:none;
      background:#000;
      border-top: 1px solid rgba(255,255,255,.06);
    }
  
    /* 提示卡片更像浮层 */
    .hint{
      position:absolute;
      left: 12px;
      right: 12px;
      bottom: 12px;
      background: rgba(0,0,0,.55);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.45;
      color: rgba(255,255,255,.9);
      backdrop-filter: blur(6px);
    }
  
    /* iPhone 刘海安全区 */
    @supports (padding: max(0px)) {
      header{ padding-top: max(var(--pad), env(safe-area-inset-top)); }
      .hint{ bottom: max(12px, env(safe-area-inset-bottom)); }
    }
  
    /* 宽屏（桌面）再变成双列 */
    @media (min-width: 860px){
      .form-grid{
        grid-template-columns: 1fr 1fr;
      }
      .actions{
        justify-content:flex-end;
      }
      .actions button{
        flex: 0 0 auto;
      }
      header{
        padding-left: 18px;
        padding-right: 18px;
      }
    }
    /* 折叠编辑面板：只留一行按钮 */
    header.collapsed .form-grid,
    header.collapsed .file {
      display: none !important;
    }
    header.collapsed {
      padding-bottom: 10px;
    }
  </style>

  <!-- 二维码库（纯前端） -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>

<body>
<div class="wrap">
  <header id="panel">
    <div class="form-grid">
      <label>姓名
        <input id="name" placeholder="张三" />
      </label>
      <label>公司/组织
        <input id="org" placeholder="Steel Press" />
      </label>
      <label>职位
        <input id="title" placeholder="Analyst" />
      </label>
      <label>电话
        <input id="tel" placeholder="+49 ..." />
      </label>
      <label>邮箱
        <input id="email" placeholder="name@example.com" />
      </label>
      <label>网址
        <input id="url" placeholder="https://..." />
      </label>
    </div>

  <div class="row">
    <label class="file">背景图（相册/拍照）
      <input id="bgFile" type="file" accept="image/*" />
    </label>
  
    <label class="file">Logo（PNG透明更佳）
      <input id="logoFile" type="file" accept="image/*" />
    </label>
  
    <div class="actions">
      <button id="regen" class="primary">生成/刷新</button>
      <button id="lock">锁定位置：开</button>
      <button id="export">导出图片</button>
      <button id="togglePanel">编辑信息</button>
    </div>
  </div>
  </header>

  <main>
    <canvas id="c"></canvas>
    <div class="hint">
      手势：单指拖动二维码；双指缩放。<br/>
      导出后：iPhone 可能需要在分享面板里“存储图像”。<br/>
      PWA 安装：iOS 用 Safari “分享 → 添加到主屏幕”。（iOS 不会自动弹安装提示是正常的）
    </div>
  </main>
</div>

<script src="./app.js"></script>
</body>
</html>
